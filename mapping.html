<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thrive Admin - Time Mapping</title>
    <link rel="icon" type="image/svg+xml" href="./assets/thrive-mascot-RGB.svg?v=teal" />
    <link rel="alternate icon" href="./favicon.ico?v=teal" sizes="any" />
    <link rel="manifest" href="./site.webmanifest" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body class="auth-pending">
    <header class="topbar">
      <div class="container topbar-inner">
        <a class="brand" href="./index.html" aria-label="Thrive Admin home">
          <img class="brand-mark" src="./assets/thrive-mascot-RGB.svg" alt="Thrive mascot logo" />
          <span class="brand-text">Thrive Admin</span>
        </a>
        <div class="topbar-actions">
          <nav id="primaryNav" class="topnav" aria-label="Primary"></nav>
          <button id="signOutBtn" class="secondary" type="button">Sign out</button>
        </div>
      </div>
    </header>

    <main class="container mapping-main">
      <section class="hero compact">
        <h1>Time Mapping</h1>
        <p>Build a driving run from a staff postcode through clients and back to the start.</p>
      </section>

      <section class="mapping-grid">
        <article class="panel staff-panel">
          <h2>Staff Start Point</h2>
          <label class="field" for="staffPostcodeInput">
            Staff postcode
            <input id="staffPostcodeInput" type="text" placeholder="e.g. SW1A 1AA" autocomplete="postal-code" />
          </label>
          <label class="field" for="carerSearchInput">
            Search associates
            <input id="carerSearchInput" type="search" placeholder="Search by name, id, or postcode" autocomplete="off" />
          </label>
          <div id="associateStatusFilters" class="status-filter-row"></div>
          <ul id="carerSearchResults" class="carer-search-results"></ul>
          <p id="carerSearchStatus" class="muted">Loading associates...</p>
        </article>

        <article class="panel">
          <h2>Client Stops</h2>
          <label class="field" for="clientSearchInput">
            Search client (name, id, location, postcode)
            <input id="clientSearchInput" type="search" placeholder="Type to search clients" autocomplete="off" />
          </label>
          <div id="clientStatusFilters" class="status-filter-row"></div>
          <div id="areaFilters" class="area-filter-row"></div>
          <ul id="clientSearchResults" class="client-search-results"></ul>
          <p id="clientSearchStatus" class="muted">Loading clients...</p>

          <label class="field" for="clientPostcodeInput">
            Add client stop manually (postcode or address)
            <div class="postcode-entry-row">
              <input id="clientPostcodeInput" type="text" placeholder="e.g. M1 1AE" autocomplete="postal-code" />
              <button id="addClientBtn" class="secondary" type="button">Add</button>
            </div>
          </label>
        </article>
      </section>

      <section class="panel">
        <section class="client-postcodes-block" aria-labelledby="clientPostcodesHeading">
          <h2 id="clientPostcodesHeading">Selected client stops</h2>
          <ul id="clientPostcodesList" class="postcode-pill-list"></ul>
          <p id="noClientsMessage" class="muted">No client stops added.</p>
        </section>

        <label class="field" for="runStartTimeInput">
          Run date
          <input id="runDateInput" type="date" />
        </label>

        <label class="field" for="runStartTimeInput">
          Run start time
          <input id="runStartTimeInput" type="time" step="600" value="09:00" />
        </label>

        <label class="field" for="visitDurationInput">
          Visit length (mins)
          <input id="visitDurationInput" type="number" min="0" step="10" value="60" />
        </label>

        <div class="row">
          <button id="calculateRunBtn" type="button">Calculate run</button>
          <button id="clearRunBtn" class="secondary" type="button">Clear</button>
        </div>

        <p id="mappingStatus" class="muted">Enter a staff postcode and at least one client stop.</p>
      </section>

      <section id="runResults" class="panel" hidden>
        <h2>Run Summary</h2>
        <p id="runTotals" class="muted"></p>
        <div id="runCostPanel" class="cost-panel">
          <p id="runCostSummary" class="muted"></p>
          <div id="runCostBreakdown" class="cost-breakdown-sections"></div>
        </div>

        <h2>Run Schedule</h2>
        <p class="muted">Assumes 1 hour per client visit. Edit any time to shift all following times.</p>
        <div id="runSchedule" class="schedule-list"></div>
        <p>
          <a id="mapsDirectionsLink" href="#" target="_blank" rel="noopener noreferrer">Open run in Google Maps</a>
        </p>

        <h2>Run Order</h2>
        <ol id="runOrderList" class="run-order-list"></ol>

        <h2>Legs</h2>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Leg</th>
                <th>From</th>
                <th>To</th>
                <th>Distance</th>
                <th>Duration</th>
              </tr>
            </thead>
            <tbody id="runLegsBody"></tbody>
          </table>
        </div>
      </section>

      <section class="panel">
        <h2>Export Runs</h2>
        <p class="muted">Name a calculated run, add it to local export storage, then download all as CSV.</p>
        <div class="mapping-form-grid">
          <label class="field" for="runNameInput">
            Run name
            <input id="runNameInput" type="text" placeholder="e.g. Tuesday Central AM" />
          </label>
        </div>
        <div class="row">
          <button id="saveRunBtn" type="button" disabled>Add run for export</button>
          <button id="exportRunsBtn" class="secondary" type="button" disabled>Download CSV</button>
        </div>
        <p id="savedRunsStatus" class="muted">No saved runs yet.</p>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Saved</th>
                <th>Name</th>
                <th>Start</th>
                <th>Stops</th>
                <th>Grand Total</th>
              </tr>
            </thead>
            <tbody id="savedRunsBody"></tbody>
          </table>
        </div>
      </section>
    </main>

    <script type="module" src="./mapping.js"></script>
  </body>
</html>
